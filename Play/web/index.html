<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Layer Depth Demo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Le styles -->
    <link href="css/bootstrap.css" rel="stylesheet">
    <style>
      body {
        padding-top: 60px; /* 60px to make the container go all the way to the bottom of the topbar */
      }
    </style>
    <link href="css/bootstrap-responsive.css" rel="stylesheet">

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le fav and touch icons -->
    <!--link rel="shortcut icon" href="favicon.ico">
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="../assets/ico/apple-touch-icon-57-precomposed.png"-->
  </head>

  <body>

    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="#">Layer Depth</a>
          <div class="nav-collapse">
            <ul class="nav">
              <li class="active"><a href="#">Home</a></li>
              <li><a href="#about">About</a></li>
              <li><a href="#contact">Contact</a></li>
            </ul>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>

    <div class="container">

      <h1>Layers Test</h1>
      <p>This is a test of my layers concept.</p>
	<form id="add-form">
		<label>color:</label><input type="text" id="test-input-color" />
		<label>layer:</label><input type="text" id="test-input-layer" />
		<input type="submit" value="add" />
	</form>
	<form id="eye-form">
		<label>x:</label><input type="text" id="test-input-x" value="0" />
		<label>y:</label><input type="text" id="test-input-y" value="0" />
		<label>d:</label><input type="text" id="test-input-d" value="10" />
		<input type="submit" value="move eyes" />
	</form>
    </div> <!-- /container -->

    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="js/jquery-1.7.2.js"></script>
    <script src="js/bootstrap.min.js"></script>
	<script>
	(function(){
		//create layers holder
		window.windowSize= {
			x: $(window).outerWidth(true),
			y: $(window).outerHeight(true)
		};
		$('body').append($('<div>').attr('id','layers').css({position:'absolute','z-index':-1,top:'0px',left:'0px',width:windowSize.x+"px",height:windowSize.y+"px",'background-color': '#dedede',overflow:'hidden'}));
		var minZindex=0;
		var getLayer= function(depth) {
			var layer_id= 'layer-'+depth;
			if(!$('#'+layer_id).length) {
				var zIndex= -1*depth;
				minZindex= Math.min(zIndex,minZindex);
				$('#layers').css({'z-index':minZindex-1}).append(
					$('<div>').addClass('layer').attr('id',layer_id).css(
						{'z-index':zIndex,width:'100%',height:'100%',position:'absolute'}
					)
				);
			}
			console.log('getLayer:'+layer_id);
			return $('#'+layer_id);
		};
		var addToLayer= function(content, depth, x, y) {
			//create the layer if it doesn't exist
			var layer= getLayer(depth);
			console.log(layer);
			//getLayer(depth).append('<div>test</div>');
			getLayer(depth).append(
				$('<div>').css(
					{position:'absolute',top:y+"px",left:x+"px"}
				).addClass('layer-content').append(content)
			);
		};
		var adjustLayers= function(eye_x, eye_y,distance) {
			$('.layer').each(function(){
				var multiplier= $(this).css('z-index')*distance;
				$(this).css({top:multiplier*eye_y, left:multiplier*eye_x});
			});
		};
		window.depthLayers= {};
		window.depthLayers.adjustLayers= adjustLayers;
		window.depthLayers.addToLayer= addToLayer;
	})();
	</script>
	<script>
		$(function() {
			//$('.my-layer-content').each(function() {
		//	addToLayer($(this).detach();
			//});
			$('#add-form').submit(function() {
				var color= $('#test-input-color').val();
				var layer= $('#test-input-layer').val();
				depthLayers.addToLayer($('<div>').css({'background-color':color,width:"200px",height:"200px"}),layer,(windowSize.x/2)-100,(windowSize.y/2)-100);
				return false;
			});
			$('#eye-form').submit(function(){
				var x= $('#test-input-x').val();
				var y= $('#test-input-y').val();
				var distance= $('#test-input-d').val();
				depthLayers.adjustLayers(x,y,distance);
				return false;
			});
			$(document).bind('mousemove', function(e) {
				$('#test-input-x').val(e.pageX/windowSize.x-0.5);
				$('#test-input-y').val(e.pageY/windowSize.y-0.5);
				$('#eye-form').submit();
			});
		});
	</script>
  </body>
</html>
